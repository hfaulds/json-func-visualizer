angular.module("jsonFunc",[]).directive("jsonFuncBuilder",function(){return{restrict:"E",templateUrl:"func_template.html",scope:{raw_data_columns:"=rawDataColumns",valid_functions:"=validFunctions",column:"="},link:function(e){var t=function(e){if(e&&e.args){var t=_.map(e.args,function(e){return e.value?e.value:e.keys?_.object(_.compact(e.keys),e.values):["list"].concat(_.compact(e.values))}),n=[e.name].concat(t);return JSON.stringify(n)}};e.valid_functions=angular.copy(e.valid_functions);if(e.column.persisted_func){var n=JSON.parse(e.column.persisted_func);e.selected_func=_.findWhere(e.valid_functions,{name:n[0]}),_.each(_.rest(n,1),function(t,n){typeof t=="object"?(e.selected_func.args[n].keys=_.keys(t),e.selected_func.args[n].values=_.values(t)):t[0]==="list"?e.selected_func.args[n].values=t:e.selected_func.args[n].value=t})}e.$watch("selected_func",function(){e.column.selected_func=t(e.selected_func)},!0),e.remove_blanks=function(e){return _.compact(e).concat([""])},e.remove_blanks_from_hash=function(e){var t=[];_.each(e.keys,function(n,r){_.identity(n)&&t.push(e.values[r]||"")}),e.keys=_.compact(e.keys).concat([""]),e.values=t}}}});
